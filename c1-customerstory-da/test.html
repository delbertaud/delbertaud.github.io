<!DOCTYPE html>
<html>
<head>
    <link href='https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css' rel='stylesheet'>
    <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.0.3/css/font-awesome.css' rel='stylesheet'>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200;300;400;500;600;700&display=swap" rel="stylesheet">
    <script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <style>
        body{background-image:url(/assets/bg.jpg);max-height: 100%;min-height: 100vh;color:#fff;font-family: 'Oswald', sans-serif;background-size: cover;background-position: bottom center;}
        
        #divSearch {display: block;text-align: left;margin-left: auto;margin-right: auto; width: 800px;}
        #divSearch2 {text-align: center;margin-left: auto;margin-right: auto; width: 350px;}
            #tableTitle {text-align: center; width:290px;}
            #tableText {text-align: left;}
            #txtSearchFor {width: 290px;}
            #tableList {text-align: left; vertical-align: top; width: 290px; size:5; background-color: #fff; color: #000;}
            #tableButton {text-align: left; vertical-align: top; width: 50px; margin-left: 10px;}

        #divAbout {display:none;text-align: center;margin-left: auto;margin-right: auto;}
        #divResults {display:none;text-align: center;margin-left: auto;margin-right: auto;}

    </style>
</head>
<body class="bg">
    <div id="divSearch">      
        <button id="btnShowAbout" >Show About</button>
        <div id='divSearch2'>
            <table>
                <tr><td id="tableTitle">Customer Name & Code:</td><td></td></tr>
                <tr><td id="tableText"><input id="txtSearchFor" type="text"></td><td></td></tr>
                <tr>
                    <td id="tableList"><iselect id="lstCompanies"></select></td>
                    <td id="tableButton"><button id="btnShowResults">Submit</button></td>
                </tr>
            </table>
        </div>
    </div>
    <div id="divAbout">
        <button id="btnShowHome1" >Home</button><br />
        <iframe id="aboutIFrameURL" src='about.html' width="800px" height="1000px"></iframe>
    </div>
    <div id="divResults">
        <button id="btnShowHome2" >Home</button>&nbsp;
        <button id="btnShowResultPage1" >Page1</button>&nbsp;
        <button id="btnShowResultPage2" >Page2</button>&nbsp;
        <button id="btnShowResultPage3" >Page3</button>&nbsp;
        <button id="btnShowResultPage4" >Page4</button><br />
        <iframe id="resultsIFrameURL" src='' width="800px;"></iframe>
    </div>

    <script>
        document.getElementById("btnShowAbout").addEventListener("click", showDivAbout);
        document.getElementById("btnShowHome1").addEventListener("click", showDivSearch);
        document.getElementById("btnShowHome2").addEventListener("click", showDivSearch);
        document.getElementById("btnShowResults").addEventListener("click", showDivResultsPage1);
        document.getElementById("btnShowResultPage1").addEventListener("click", showDivResultsPage1);
        document.getElementById("btnShowResultPage2").addEventListener("click", showDivResultsPage2);
        document.getElementById("btnShowResultPage3").addEventListener("click", showDivResultsPage3);
        document.getElementById("btnShowResultPage4").addEventListener("click", showDivResultsPage4);

        function showDivAbout() {
            document.getElementById("divSearch").style.display = "none";
            document.getElementById("divResults").style.display = "none"; 
            document.getElementById("divAbout").style.display = "block";
        }

        function showDivSearch() {
            document.getElementById("divAbout").style.display = "none";
            document.getElementById("divResults").style.display = "none"; 
            document.getElementById("divSearch").style.display = "block";
        }

        function showDivResultsPage1() {
            document.getElementById("divSearch").style.display = "none";
            document.getElementById("divAbout").style.display = "none";
            document.getElementById("divResults").style.display = "block"; 
            document.getElementById("resultsIFrameURL").src = "testpage1.html?searchquery"
        }

        function showDivResultsPage2() {
            document.getElementById("resultsIFrameURL").src = "testpage2.html?searchquery"
        }

        function showDivResultsPage3() {
            document.getElementById("resultsIFrameURL").src = "testpage3.html?searchquery"
        }

        function showDivResultsPage4() {
            document.getElementById("resultsIFrameURL").src = "testpage4.html?searchquery"
        }

        findCompanies();

        function findCompanies() {
            document.getElementById("btnShowResults").disabled = true;
            searchForValue = document.getElementById("txtSearchFor").value.toLowerCase();

            endpointToHit = 1
            if (endpointToHit == 1) {
                url = "https://c1apitest.delbertaud.com/" + searchForValue;
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function() { 
                    if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                        contents = "";
                        data = JSON.parse(xmlHttp.responseText);
                        data.forEach(function(element) { contents += `<option value="${element}">${element}</option>` });
                        document.getElementById("lstCompanies").innerHTML = contents;
                    }
                }
                xmlHttp.open("GET", url, true); 
                xmlHttp.send(null);
            } else if (endpointToHit == 2) {
                url = "https://customerstory.onguard.convergeone.com/csapi/" + searchForValue;
                var xhr = new XMLHttpRequest();
                xhr.withCredentials = true;
                xhr.onreadystatechange = function() { 
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        contents = "";
                        data = JSON.parse(xhr.responseText);
                        data.forEach(function(element) { contents += `<option value="${element}">${element}</option>` });
                        document.getElementById("lstCompanies").innerHTML = contents;
                    }
                };
                xhr.open("GET", url);
                xhr.setRequestHeader("Authorization", "Basic Y3NhcGk6cDljVTRudkp4V0xSMTlFamJPSTA=");
                xhr.send();	
            } else if (endpointToHit == 3) {
                var myHeaders = new Headers();
                myHeaders.append("Authorization", "Basic Y3NhcGk6cDljVTRudkp4V0xSMTlFamJPSTA=");
                var requestOptions = {
                    method: 'GET',
                    headers: myHeaders,
                    redirect: 'follow'
                };

                fetch("https://customerstory.onguard.convergeone.com/csapi/", requestOptions)
                .then(response => response.text())
                .then(result => console.log(result))
                .catch(error => console.log('error', error));
            }
            return false; 
        }

        document.getElementById("txtSearchFor").onkeyup = function(e) {
            if (!e) e = window.event;
            keyCode = e.code || e.key;
            if (keyCode == "Tab") {
                return;
            }
            if (keyCode == "ArrowDown"){
                document.getElementById("lstCompanies").focus()
                return;
            }
            if (keyCode == "ArrowUp" || keyCode == "ArrowRight" || keyCode == "ArrowLeft"){
                return;
            }
            findCompanies();
        }

        document.getElementById("lstCompanies").onfocus = function(e) {
            if (document.getElementById("lstCompanies").selectedIndex == -1) {
                document.getElementById("lstCompanies").selectedIndex = 0;
                document.getElementById("btnShowResults").disabled = false;
                document.getElementById("txtSearchFor").value = document.getElementById("lstCompanies").selectedOptions[0].innerText;
            }
        }


        document.getElementById("lstCompanies").onchange = function(e) {
            document.getElementById("txtSearchFor").value = document.getElementById("lstCompanies").selectedOptions[0].innerText;
            document.getElementById("btnShowResults").disabled = false;
        }

    </script>
    <script type='text/javascript' src='https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js'></script>
</body>
</html>