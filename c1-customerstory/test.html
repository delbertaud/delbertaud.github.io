<!DOCTYPE html>
<html>
<head>
    <style>
        #divSearch { display: block; }
        #divAbout { display: none; }
        #divResults { display: none; }
    </style>
</head>
<body>
    <div id="divSearch">
        <button id="btnShowAbout" >Show About</button><br />
        <table width="360px">
            <tr>
                <th colspan=2>Customer Name & Code:</th>
            </tr><tr>
                <td width="300px" colspan=2><input id="txtSearchFor" type="text" size="35"></td>
            </tr><tr>
                <td width="300px"><select id="lstCompanies" size="20" width="290px"></select></td>
                <td width="50px"><button id="btnShowResults">Submit</button></td>
            </tr>
        </table>
    </div>
    <div id="divAbout">
        <button id="btnShowHome1" >Home</button><br />
        <iframe id="aboutIFrameURL" src='about.html' width="800px" height="1000px"></iframe>
    </div>
    <div id="divResults">
        <button id="btnShowHome2" >Home</button>&nbsp;
        <button id="btnShowResultPage1" >Page1</button>&nbsp;
        <button id="btnShowResultPage2" >Page2</button>&nbsp;
        <button id="btnShowResultPage3" >Page3</button>&nbsp;
        <button id="btnShowResultPage4" >Page4</button><br />
        <iframe id="resultsIFrameURL" src='' width="800px;"></iframe>
    </div>

    <script>
        document.getElementById("btnShowAbout").addEventListener("click", showDivAbout);
        document.getElementById("btnShowHome1").addEventListener("click", showDivSearch);
        document.getElementById("btnShowHome2").addEventListener("click", showDivSearch);
        document.getElementById("btnShowResults").addEventListener("click", showDivResultsPage1);
        document.getElementById("btnShowResultPage1").addEventListener("click", showDivResultsPage1);
        document.getElementById("btnShowResultPage2").addEventListener("click", showDivResultsPage2);
        document.getElementById("btnShowResultPage3").addEventListener("click", showDivResultsPage3);
        document.getElementById("btnShowResultPage4").addEventListener("click", showDivResultsPage4);

        function showDivAbout() {
            document.getElementById("divSearch").style.display = "none";
            document.getElementById("divResults").style.display = "none"; 
            document.getElementById("divAbout").style.display = "block";
        }

        function showDivSearch() {
            document.getElementById("divAbout").style.display = "none";
            document.getElementById("divResults").style.display = "none"; 
            document.getElementById("divSearch").style.display = "block";
        }

        function showDivResultsPage1() {
            document.getElementById("divSearch").style.display = "none";
            document.getElementById("divAbout").style.display = "none";
            document.getElementById("divResults").style.display = "block"; 
            document.getElementById("resultsIFrameURL").src = "testpage1.html?searchquery"
        }

        function showDivResultsPage2() {
            document.getElementById("resultsIFrameURL").src = "testpage2.html?searchquery"
        }

        function showDivResultsPage3() {
            document.getElementById("resultsIFrameURL").src = "testpage3.html?searchquery"
        }

        function showDivResultsPage4() {
            document.getElementById("resultsIFrameURL").src = "testpage4.html?searchquery"
        }

        findCompanies();

        function findCompanies() {
            document.getElementById("btnShowResults").disabled = true;
            searchForValue = document.getElementById("txtSearchFor").value.toLowerCase();

            endpointToHit = 1
            if (endpointToHit == 1) {
                url = "https://c1apitest.delbertaud.com/" + searchForValue;
                var xmlHttp = new XMLHttpRequest();
                xmlHttp.onreadystatechange = function() { 
                    if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                        contents = "";
                        data = JSON.parse(xmlHttp.responseText);
                        data.forEach(function(element) { contents += `<option value="${element}">${element}</option>` });
                        document.getElementById("lstCompanies").innerHTML = contents;
                    }
                }
                xmlHttp.open("GET", url, true); 
                xmlHttp.send(null);
            } else if (endpointToHit == 2) {
                url = "https://customerstory.onguard.convergeone.com/csapi/" + searchForValue;
                var xhr = new XMLHttpRequest();
                xhr.withCredentials = true;
                xhr.onreadystatechange = function() { 
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        contents = "";
                        data = JSON.parse(xhr.responseText);
                        data.forEach(function(element) { contents += `<option value="${element}">${element}</option>` });
                        document.getElementById("lstCompanies").innerHTML = contents;
                    }
                };
                xhr.open("GET", url);
                xhr.setRequestHeader("Authorization", "Basic Y3NhcGk6cDljVTRudkp4V0xSMTlFamJPSTA=");
                xhr.send();	
            } else if (endpointToHit == 3) {
                var myHeaders = new Headers();
                myHeaders.append("Authorization", "Basic Y3NhcGk6cDljVTRudkp4V0xSMTlFamJPSTA=");
                var requestOptions = {
                    method: 'GET',
                    headers: myHeaders,
                    redirect: 'follow'
                };

                fetch("https://customerstory.onguard.convergeone.com/csapi/", requestOptions)
                .then(response => response.text())
                .then(result => console.log(result))
                .catch(error => console.log('error', error));
            }
            return false; 
        }

        document.getElementById("txtSearchFor").onkeyup = function(e) {
            if (!e) e = window.event;
            keyCode = e.code || e.key;
            if (keyCode == "Tab") {
                return;
            }
            if (keyCode == "ArrowDown"){
                document.getElementById("lstCompanies").focus()
                return;
            }
            if (keyCode == "ArrowUp" || keyCode == "ArrowRight" || keyCode == "ArrowLeft"){
                return;
            }
            findCompanies();
        }

        document.getElementById("lstCompanies").onfocus = function(e) {
            if (document.getElementById("lstCompanies").selectedIndex == -1) {
                document.getElementById("lstCompanies").selectedIndex = 0;
                document.getElementById("btnShowResults").disabled = false;
                document.getElementById("txtSearchFor").value = document.getElementById("lstCompanies").selectedOptions[0].innerText;
            }
        }


        document.getElementById("lstCompanies").onchange = function(e) {
            document.getElementById("txtSearchFor").value = document.getElementById("lstCompanies").selectedOptions[0].innerText;
            document.getElementById("btnShowResults").disabled = false;
        }

    </script>
</body>
</html>